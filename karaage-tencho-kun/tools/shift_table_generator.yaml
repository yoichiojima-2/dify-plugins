identity:
  name: "shift_table_generator"
  author: "yoichiojima"
  label:
    en_US: "Shift Table Generator"
    ja_JP: "シフト表生成"
description:
  human:
    en_US: "Get shift table data in JSON format"
    ja_JP: "シフト表データをJSON形式で取得"
  llm: |
    シフトデータをJSON形式で取得します。
    取得したデータをもとに、HTMLシフト表を生成してください。

    ## ビュータイプ
    - weekly: 週間シフトデータ
      - スタッフ情報（id, name, role, skills, hourly_rate）
      - 日付情報（date, weekday, is_weekend, is_today）
      - スタッフごとの日付別シフト（start, end, status）
      - 集計（total_shifts, total_hours, staff_count, daily_avg_hours）
    - daily: 日次シフトデータ
      - 指定日のシフト一覧（staff_id, name, role, skills, start, end, status）
      - 時間帯別カバレッジ（6時〜24時、各時間に誰がいるか）
    - staff: スタッフ別2週間データ
      - スタッフ情報
      - 2週間分のシフト
      - 合計時間と推定給与

    ## overrides（シフト変更の反映）
    会話中にshift_managerでシフトを変更した場合、その変更情報をoverridesパラメータに渡してください。
    DB更新はプロセス間で共有されないため、overridesで変更を伝える必要があります。

    **フォーマット（JSON文字列）:**
    {"cancelled": [{"staff_id": "tanaka", "date": "2026-02-17"}], "added": [{"staff_id": "kobayashi", "name": "小林花子", "date": "2026-02-17", "start": "06:00", "end": "15:00"}]}

    - cancelled: キャンセルしたシフト（staff_id + date で指定）
    - added: 追加したシフト（staff_id + name + date + start + end で指定）

    **重要:** shift_managerでUPDATE/INSERTした後にこのツールを呼ぶ場合は、必ずoverridesを指定すること。
    overridesを省略するとシフト表にDB変更が反映されない。

    ## 使用例
    - 今週のシフト: view_type="weekly"
    - 特定週: view_type="weekly", start_date="2026-02-16"
    - 特定日: view_type="daily", start_date="2026-02-20"
    - スタッフ別: view_type="staff"
    - 変更反映: view_type="daily", start_date="2026-02-17", overrides='{"cancelled": [{"staff_id": "tanaka", "date": "2026-02-17"}]}'

    ## 出力
    JSON形式のデータを返します。
    dashboard_templateツール(shift_table)でテンプレートを取得し、プレースホルダーをデータで置換して
    そのままチャットメッセージとしてHTMLを出力してください。
parameters:
  - name: view_type
    type: string
    required: false
    label:
      en_US: View Type
      ja_JP: ビュータイプ
    human_description:
      en_US: "Type of shift data to retrieve (weekly/daily/staff)"
      ja_JP: "取得するシフトデータの種類（weekly/daily/staff）"
    llm_description: "ビュータイプ: weekly（週間）、daily（日次）、staff（スタッフ別2週間）。省略時は weekly"
    form: llm
    default: weekly
  - name: start_date
    type: string
    required: false
    label:
      en_US: Start Date
      ja_JP: 開始日
    human_description:
      en_US: "Start date (YYYY-MM-DD)"
      ja_JP: "開始日（YYYY-MM-DD形式）"
    llm_description: "開始日（YYYY-MM-DD形式）。省略時は今週の月曜日"
    form: llm
  - name: overrides
    type: string
    required: false
    label:
      en_US: Overrides
      ja_JP: シフト変更オーバーライド
    human_description:
      en_US: "JSON string with shift changes to apply (cancelled/added)"
      ja_JP: "シフト変更情報（JSON文字列）。cancelled と added を指定"
    llm_description: "会話中にshift_managerでシフト変更した場合、その変更をJSON文字列で渡す。例: {\"cancelled\": [{\"staff_id\": \"tanaka\", \"date\": \"2026-02-17\"}], \"added\": [{\"staff_id\": \"kobayashi\", \"name\": \"小林花子\", \"date\": \"2026-02-17\", \"start\": \"06:00\", \"end\": \"15:00\"}]}。shift_manager実行後は必ず指定すること。"
    form: llm
extra:
  python:
    source: tools/shift_table_generator.py
